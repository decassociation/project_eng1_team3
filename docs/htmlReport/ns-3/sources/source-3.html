


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > CustomerController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.team3gdx.game.entity</a>
</div>

<h1>Coverage Summary for Class: CustomerController (com.team3gdx.game.entity)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CustomerController</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    75%
  </span>
  <span class="absValue">
    (6/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    68.5%
  </span>
  <span class="absValue">
    (74/108)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.team3gdx.game.entity;
&nbsp;
&nbsp;import java.util.*;
&nbsp;import java.util.concurrent.ThreadLocalRandom;
&nbsp;
&nbsp;import com.badlogic.gdx.graphics.g2d.Batch;
&nbsp;import com.badlogic.gdx.maps.MapProperties;
&nbsp;import com.badlogic.gdx.maps.tiled.TiledMap;
&nbsp;import com.badlogic.gdx.maps.tiled.TiledMapTile;
&nbsp;import com.badlogic.gdx.maps.tiled.TiledMapTileLayer;
&nbsp;import com.badlogic.gdx.maps.tiled.TiledMapTileLayer.Cell;
&nbsp;import com.badlogic.gdx.math.Vector2;
&nbsp;
&nbsp;public class CustomerController {
&nbsp;	int lockout;
&nbsp;	public int amountActiveCustomers;
&nbsp;	ArrayList&lt;ArrayList&lt;Integer&gt;&gt; customerCells;
<b class="fc">&nbsp;	public Customer[] customers = new Customer[5];</b>
<b class="fc">&nbsp;	Customer[] leavingcustomers = new Customer[5];</b>
&nbsp;	TiledMap gameMap;
&nbsp;	int top;
&nbsp;	int bottom;
&nbsp;	int xCoordinate;
&nbsp;	private long timeOfLastCustomer;
&nbsp;	private int timeUntilNext;
&nbsp;	private int spawnMultiple;
&nbsp;	public int totalServed;
&nbsp;	private String difficulty;
&nbsp;	private HashMap&lt;String, Float&gt; difficultyMultipliers;
&nbsp;
<b class="fc">&nbsp;	public CustomerController(TiledMap map, String difficulty) {</b>
<b class="fc">&nbsp;		this.gameMap = map;</b>
<b class="fc">&nbsp;		computeCustomerZone(gameMap);</b>
<b class="fc">&nbsp;		amountActiveCustomers = 0;</b>
<b class="fc">&nbsp;		lockout = 0;</b>
<b class="fc">&nbsp;		totalServed = 0;</b>
&nbsp;
<b class="fc">&nbsp;		this.difficulty = difficulty;</b>
<b class="fc">&nbsp;		difficultyMultipliers = new HashMap&lt;&gt;();</b>
<b class="fc">&nbsp;		difficultyMultipliers.put(&quot;easy&quot;, 1.25f);</b>
<b class="fc">&nbsp;		difficultyMultipliers.put(&quot;normal&quot;, 1f);</b>
<b class="fc">&nbsp;		difficultyMultipliers.put(&quot;hard&quot;, 0.75f);</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Check whether the customer zone is correct in the tile map, and construct
&nbsp;	 * data structures for it
&nbsp;	 * 
&nbsp;	 * @param gameMap - The game tilemap
&nbsp;	 */
&nbsp;	private void computeCustomerZone(TiledMap gameMap) {
&nbsp;		// ==============================================================================================================
<b class="fc">&nbsp;		TiledMapTileLayer botlayer = (TiledMapTileLayer) gameMap.getLayers().get(0);</b>
<b class="fc">&nbsp;		customerCells = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;		int mapheight = botlayer.getHeight();</b>
<b class="fc">&nbsp;		int mapwidth = botlayer.getWidth();</b>
<b class="fc">&nbsp;		for (int y = 0; y &lt; mapheight; y++) {</b>
<b class="fc">&nbsp;			for (int x = 0; x &lt; mapwidth; x++) {</b>
<b class="fc">&nbsp;				Cell cel1 = botlayer.getCell(x, y);</b>
<b class="fc">&nbsp;				if (cel1 != null) {</b>
<b class="fc">&nbsp;					TiledMapTile til1 = cel1.getTile();</b>
<b class="fc">&nbsp;					MapProperties mp1 = til1.getProperties();</b>
<b class="fc">&nbsp;					Object value = mp1.get(&quot;customer_zone&quot;);</b>
<b class="fc">&nbsp;					boolean isCustomerZone = value != null &amp;&amp; (boolean) value;</b>
<b class="fc">&nbsp;					if (isCustomerZone) {</b>
<b class="fc">&nbsp;						ArrayList&lt;Integer&gt; e = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;						e.add(x);</b>
<b class="fc">&nbsp;						e.add(y);</b>
<b class="fc">&nbsp;						customerCells.add(e);</b>
&nbsp;					}
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;		// ^Scan tilemap for Customer zone
&nbsp;		// tile==========================================================================
<b class="fc">&nbsp;		if (customerCells.size() == 0) {</b>
<b class="fc">&nbsp;			throw new IllegalArgumentException(&quot;No customer zone was included in the tile map&quot;);</b>
&nbsp;		}
&nbsp;		// ^If no Customer zone tiles exist throw
&nbsp;		// exception==============================================================
<b class="fc">&nbsp;		Integer[] xvalues = new Integer[customerCells.size()];</b>
<b class="fc">&nbsp;		Integer[] yvalues = new Integer[customerCells.size()];</b>
<b class="fc">&nbsp;		int ctr = 0;</b>
<b class="fc">&nbsp;		for (ArrayList&lt;Integer&gt; xypair : customerCells) {</b>
<b class="fc">&nbsp;			xvalues[ctr] = xypair.get(0);</b>
<b class="fc">&nbsp;			yvalues[ctr] = xypair.get(1);</b>
<b class="fc">&nbsp;			ctr++;</b>
<b class="fc">&nbsp;		}</b>
&nbsp;		// ^Split x y pairs into 2 separate
&nbsp;		// arrays=======================================================================
<b class="fc">&nbsp;		Set&lt;Integer&gt; uniquexvalues = new HashSet&lt;&gt;(Arrays.asList(xvalues));</b>
<b class="fc">&nbsp;		if (uniquexvalues.size() != 2) {</b>
<b class="nc">&nbsp;			throw new IllegalArgumentException(&quot;Customer zone must be a 2 wide rectangle leading to bottom of map&quot;);</b>
&nbsp;		}
&nbsp;		// ^Throw exception if more than 2 unique x values exist - the rectangle is not
&nbsp;		// 2 wide===========================
<b class="fc">&nbsp;		ArrayList&lt;Integer&gt; yvalueslist = new ArrayList&lt;&gt;(Arrays.asList(yvalues));</b>
<b class="fc">&nbsp;		if (!yvalueslist.contains(0)) {</b>
<b class="nc">&nbsp;			throw new IllegalArgumentException(&quot;Customer zone must extend to the bottom of the map&quot;);</b>
&nbsp;		}
&nbsp;		// ^Throw exception if the customer zone tile list does not contain tiles at the
&nbsp;		// bottom index====================
<b class="fc">&nbsp;		int ymax = Collections.max(yvalueslist);</b>
<b class="fc">&nbsp;		Integer[] uniquexvaluesarray = uniquexvalues.toArray(new Integer[] {});</b>
<b class="fc">&nbsp;		for (Integer unx : uniquexvaluesarray) {</b>
<b class="fc">&nbsp;			for (int i = ymax; i &gt; 0; i--) {</b>
<b class="fc">&nbsp;				ArrayList&lt;Integer&gt; templist = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;				templist.add(unx);</b>
<b class="fc">&nbsp;				templist.add(i);</b>
<b class="fc">&nbsp;				if (!customerCells.contains(templist)) {</b>
<b class="nc">&nbsp;					throw new IllegalArgumentException(&quot;Customer zone must be a filled rectangle&quot;);</b>
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;		// ^Throw exception if the customer zone is not a filled rectangle. It does this
&nbsp;		// by looking from the maximum=====
&nbsp;		// y value downwards to check if a tile exists all the way down to zero, on both
&nbsp;		// columns.
<b class="fc">&nbsp;		this.top = ymax;</b>
<b class="fc">&nbsp;		this.bottom = 0;</b>
<b class="fc">&nbsp;		this.xCoordinate = xvalues[0]; // We can do this because the search scans left to right, 0th value will be left</b>
&nbsp;	}
&nbsp;
&nbsp;	public Customer spawnCustomer() {
<b class="fc">&nbsp;		timeOfLastCustomer = System.currentTimeMillis();</b>
<b class="fc">&nbsp;		timeUntilNext = ThreadLocalRandom.current().nextInt((int) (28000 * difficultyMultipliers.get(difficulty)), (int) (40001 * difficultyMultipliers.get(difficulty)));</b>
&nbsp;
<b class="fc">&nbsp;		for (int i = 0; i &lt; this.customers.length; i++) {</b>
<b class="fc">&nbsp;			if (customers[i] == null) {</b>
<b class="fc">&nbsp;				customers[i] = new Customer(this.xCoordinate, this.bottom, this.top - i, i);</b>
<b class="fc">&nbsp;				amountActiveCustomers += 1;</b>
<b class="fc">&nbsp;				return customers[i];</b>
&nbsp;			}
&nbsp;		}
<b class="nc">&nbsp;		return null;</b>
&nbsp;	}
&nbsp;
&nbsp;	public void delCustomer(int num) {
<b class="fc">&nbsp;		if (this.customers[num].locked) {</b>
<b class="fc">&nbsp;			amountActiveCustomers -= 1;</b>
<b class="fc">&nbsp;			this.leavingcustomers[num] = this.customers[num];</b>
<b class="fc">&nbsp;			this.leavingcustomers[num].setTargetsquare(-1);</b>
<b class="fc">&nbsp;			this.customers[num] = null;</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	public void delCustomer(Customer customer) {
<b class="fc">&nbsp;		for (int i = 0; i &lt; this.customers.length; i++) {</b>
<b class="fc">&nbsp;			if (customers[i] == customer) {</b>
<b class="fc">&nbsp;				delCustomer(i);</b>
&nbsp;				return;
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Draw top of customers
&nbsp;	 * 
&nbsp;	 * @param b1 - spritebatch to render with
&nbsp;	 */
&nbsp;	public void drawCustTop(Batch b1) {
<b class="nc">&nbsp;		for (Customer c : this.customers) {</b>
<b class="nc">&nbsp;			if (c != null) {</b>
<b class="nc">&nbsp;				c.renderCustomersBot(b1);</b>
&nbsp;			}
&nbsp;		}
<b class="nc">&nbsp;		for (Customer c : this.leavingcustomers) {</b>
<b class="nc">&nbsp;			if (c != null) {</b>
<b class="nc">&nbsp;				c.renderCustomersBot(b1);</b>
&nbsp;			}
&nbsp;		}
<b class="nc">&nbsp;		for (Customer c : this.customers) {</b>
<b class="nc">&nbsp;			if (c != null) {</b>
<b class="nc">&nbsp;				c.renderCustomersTop(b1);</b>
&nbsp;			}
&nbsp;		}
<b class="nc">&nbsp;		for (Customer c : this.leavingcustomers) {</b>
<b class="nc">&nbsp;			if (c != null) {</b>
<b class="nc">&nbsp;				c.renderCustomersTop(b1);</b>
&nbsp;			}
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Update customers
&nbsp;	 */
&nbsp;	public void updateCustomers() {
&nbsp;		// spawn new if it has been long enough
<b class="nc">&nbsp;		if(System.currentTimeMillis() - timeOfLastCustomer &gt;= timeUntilNext){</b>
<b class="nc">&nbsp;			spawnCustomer();</b>
&nbsp;
&nbsp;			//random chance for second
<b class="nc">&nbsp;			if(totalServed &gt; 3) {</b>
<b class="nc">&nbsp;				spawnMultiple = ThreadLocalRandom.current().nextInt(0, 4);</b>
<b class="nc">&nbsp;				if (spawnMultiple == 0) spawnCustomer();</b>
&nbsp;			}
&nbsp;
&nbsp;			//random chance for third
<b class="nc">&nbsp;			if(totalServed &gt; 10) {</b>
<b class="nc">&nbsp;				spawnMultiple = ThreadLocalRandom.current().nextInt(0, 10);</b>
<b class="nc">&nbsp;				if (spawnMultiple == 0) spawnCustomer();</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		for (Customer c : this.customers) {</b>
<b class="nc">&nbsp;			if (c != null) {</b>
<b class="nc">&nbsp;				c.stepTarget();</b>
&nbsp;			}
&nbsp;		}
<b class="nc">&nbsp;		int ctr = 0;</b>
<b class="nc">&nbsp;		for (Customer c : this.leavingcustomers) {</b>
<b class="nc">&nbsp;			if (c != null) {</b>
<b class="nc">&nbsp;				c.stepTarget();</b>
<b class="nc">&nbsp;				if (c.readyfordeletion) {</b>
<b class="nc">&nbsp;					this.leavingcustomers[ctr] = null;</b>
&nbsp;				}
&nbsp;			}
<b class="nc">&nbsp;			ctr++;</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Check if any of the customers is at one position
&nbsp;	 * 
&nbsp;	 * @param pos - vector position
&nbsp;	 * @return null if no customers are at that position, return the customer that
&nbsp;	 *         is at that position
&nbsp;	 */
&nbsp;	public Customer isCustomerAtPos(Vector2 pos) {
<b class="fc">&nbsp;		for (Customer customer : customers)</b>
<b class="fc">&nbsp;			if (customer != null &amp;&amp; Math.ceil(customer.posx / 64f) == pos.x &amp;&amp; Math.ceil(customer.posy / 64f) == pos.y</b>
&nbsp;					&amp;&amp; customer.locked)
<b class="fc">&nbsp;				return customer;</b>
<b class="fc">&nbsp;		return null;</b>
&nbsp;	}
&nbsp;
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-03-28 10:16</div>
</div>
</body>
</html>
